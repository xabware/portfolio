import{r as e,j as r}from"./react-vendor-8JC65cQs.js";import{C as s}from"./webllm-Ba7gmaw5.js";import"./vendor-BFzfhu5-.js";const a=e.createContext(void 0),t=({children:t})=>{const o=e.useRef(null),[n,i]=e.useState(0),[l,c]=e.useState(0),[u,d]=e.useState(null),[m,p]=e.useState("No inicializado"),[f,g]=e.useState(0),[b,h]=e.useState([]),[v,y]=e.useState(0),E=e.useRef(0),C=e.useCallback(async()=>{if(!(l||n||E.current||o.current))try{E.current=1,i(1),d(null),p("Inicializando motor de IA...");const e=await s("Phi-3.5-mini-instruct-q4f16_1-MLC",{initProgressCallback:e=>{p(e.text)}});o.current=e,c(1),p("Modelo cargado y listo"),d(null)}catch(e){const r=e instanceof Error?e.message:"Error desconocido";d("Error al inicializar el modelo: "+r),p("Error en la inicialización"),o.current=null,c(0)}finally{i(0),E.current=0}},[l,n]),S=e.useCallback(async e=>{if(!o.current||!l)throw Error("El modelo aún no está listo. Por favor espera...");try{const r=[{role:"system",content:"Eres un asistente virtual de un portafolio profesional. \nTu objetivo es responder preguntas sobre la experiencia, proyectos y habilidades del desarrollador de manera profesional y amigable.\nSi no tienes información específica, proporciona una respuesta general útil y profesional.\nMantén las respuestas concisas pero informativas (máximo 3-4 oraciones)."},{role:"user",content:e}],s=await o.current.chat.completions.create({messages:r,temperature:.7,max_tokens:256});return s.choices[0]?.message?.content||"Lo siento, no pude generar una respuesta."}catch(r){throw Error("Error al procesar tu mensaje. Por favor intenta de nuevo.")}},[l]),L=e.useCallback(()=>{o.current=null,c(0),i(0),d(null),p("No inicializado"),g(0),h([]),y(0),E.current=0},[]),M=e.useCallback(e=>{h(r=>[...r,e])},[]),x=e.useCallback(()=>{h([])},[]);e.useEffect(()=>()=>{o.current&&(o.current=null)},[]);const j=e.useMemo(()=>({isLoading:n,isInitialized:l,error:u,sendMessage:S,initProgress:m,initialize:C,reset:L,hasStarted:f,setHasStarted:g,messages:b,addMessage:M,clearMessages:x,isLoadingResponse:v,setIsLoadingResponse:y}),[n,l,u,S,m,C,L,f,b,M,x,v]);return r.jsx(a.Provider,{value:j,children:t})},o=()=>{const r=e.useContext(a);if(!r)throw Error("useWebLLM must be used within WebLLMProvider");return r};export{t as WebLLMProvider,o as useWebLLM};
