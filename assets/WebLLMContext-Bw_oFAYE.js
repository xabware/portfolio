import{r as e,j as r}from"./react-vendor-ORRQschO.js";import{C as s}from"./webllm-CA5sf8U-.js";import"./vendor-nLDBUfSY.js";const n=e.createContext(void 0),o=({children:o})=>{const a=e.useRef(null),[t,i]=e.useState(!1),[l,c]=e.useState(!1),[u,d]=e.useState(null),[m,p]=e.useState("No inicializado"),[f,g]=e.useState(!1),[b,h]=e.useState([]),[E,v]=e.useState(!1),y=e.useRef(!1),L=e.useCallback(async()=>{if(!(l||t||y.current||a.current))try{y.current=!0,i(!0),d(null),p("Inicializando motor de IA...");const e=await s("Phi-3.5-mini-instruct-q4f16_1-MLC",{initProgressCallback:e=>{p(e.text)}});a.current=e,c(!0),p("Modelo cargado y listo"),d(null)}catch(e){const r=e instanceof Error?e.message:"Error desconocido";d(`Error al inicializar el modelo: ${r}`),p("Error en la inicialización"),console.error("Error initializing WebLLM:",e),a.current=null,c(!1)}finally{i(!1),y.current=!1}},[l,t]),w=e.useCallback(async e=>{if(!a.current||!l)throw new Error("El modelo aún no está listo. Por favor espera...");try{const r=[{role:"system",content:"Eres un asistente virtual de un portafolio profesional. \nTu objetivo es responder preguntas sobre la experiencia, proyectos y habilidades del desarrollador de manera profesional y amigable.\nSi no tienes información específica, proporciona una respuesta general útil y profesional.\nMantén las respuestas concisas pero informativas (máximo 3-4 oraciones)."},{role:"user",content:e}],s=await a.current.chat.completions.create({messages:r,temperature:.7,max_tokens:256});return s.choices[0]?.message?.content||"Lo siento, no pude generar una respuesta."}catch(r){throw console.error("Error sending message:",r),new Error("Error al procesar tu mensaje. Por favor intenta de nuevo.")}},[l]),C=e.useCallback(()=>{a.current=null,c(!1),i(!1),d(null),p("No inicializado"),g(!1),h([]),v(!1),y.current=!1},[]),M=e.useCallback(e=>{h(r=>[...r,e])},[]),S=e.useCallback(()=>{h([])},[]);e.useEffect(()=>()=>{a.current&&(a.current=null)},[]);const x=e.useMemo(()=>({isLoading:t,isInitialized:l,error:u,sendMessage:w,initProgress:m,initialize:L,reset:C,hasStarted:f,setHasStarted:g,messages:b,addMessage:M,clearMessages:S,isLoadingResponse:E,setIsLoadingResponse:v}),[t,l,u,w,m,L,C,f,b,M,S,E]);return r.jsx(n.Provider,{value:x,children:o})},a=()=>{const r=e.useContext(n);if(!r)throw new Error("useWebLLM must be used within WebLLMProvider");return r};export{o as WebLLMProvider,a as useWebLLM};
